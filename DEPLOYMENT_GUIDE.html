<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMPES Application Deployment Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        h4 {
            color: #34495e;
            margin-top: 20px;
        }
        code {
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            overflow-x: auto;
            margin: 15px 0;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            color: #333;
        }
        .toc {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            margin: 8px 0;
        }
        .toc a {
            text-decoration: none;
            color: #2980b9;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        .highlight {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .step {
            background-color: #e8f4fd;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .step-number {
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 50%;
            display: inline-block;
            width: 25px;
            text-align: center;
            margin-right: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
            .highlight, .success, .warning, .error, .step {
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IMPES Application Deployment Guide</h1>
        
        <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#overview">1. Overview</a></li>
                <li><a href="#prerequisites">2. Prerequisites</a></li>
                <li><a href="#local-development">3. Local Development Setup</a></li>
                <li><a href="#deployment">4. Deployment to New Machine</a></li>
                <li><a href="#github-registry">5. Pushing Images to GitHub Container Registry</a></li>
                <li><a href="#troubleshooting">6. Troubleshooting</a></li>
                <li><a href="#maintenance">7. Maintenance</a></li>
            </ul>
        </div>

        <h2 id="overview">1. Overview</h2>
        <p>This guide covers the complete deployment workflow for the IMPES (Integrated Management and Project Execution System) application. The application is containerized using Docker and consists of:</p>
        <ul>
            <li><strong>Frontend</strong>: React application served via Nginx</li>
            <li><strong>Backend</strong>: Node.js/Express API</li>
            <li><strong>Database</strong>: MySQL 8.0</li>
            <li><strong>Reverse Proxy</strong>: Nginx for routing and load balancing</li>
        </ul>

        <h2 id="prerequisites">2. Prerequisites</h2>
        
        <h3>Required Software</h3>
        <ul>
            <li>Docker Engine 20.10+</li>
            <li>Docker Compose 2.0+</li>
            <li>Git</li>
            <li>At least 4GB RAM</li>
            <li>10GB free disk space</li>
        </ul>

        <h3>System Requirements</h3>
        <ul>
            <li>Linux (Ubuntu 20.04+ recommended)</li>
            <li>Ports 80, 3000, 3306, 5173 available</li>
            <li>Internet connection for initial image pulls</li>
        </ul>

        <h2 id="local-development">3. Local Development Setup</h2>

        <div class="step">
            <span class="step-number">1</span>
            <strong>Clone Repository</strong>
        </div>
        <pre><code>git clone &lt;your-repository-url&gt;
cd impes</code></pre>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Environment Configuration</strong>
        </div>
        <p>The application is configured to use relative URLs, making it portable without configuration changes.</p>

        <div class="step">
            <span class="step-number">3</span>
            <strong>Start Development Environment</strong>
        </div>
        <pre><code># Build all containers
docker-compose build

# Start services
docker-compose up -d

# Check status
docker-compose ps</code></pre>

        <div class="step">
            <span class="step-number">4</span>
            <strong>Access Application</strong>
        </div>
        <ul>
            <li><strong>Frontend</strong>: <a href="http://localhost/impes/">http://localhost/impes/</a></li>
            <li><strong>API</strong>: <a href="http://localhost/api/">http://localhost/api/</a></li>
            <li><strong>Uploads</strong>: <a href="http://localhost/uploads/">http://localhost/uploads/</a></li>
        </ul>

        <h2 id="deployment">4. Deployment to New Machine</h2>

        <div class="step">
            <span class="step-number">1</span>
            <strong>Install Docker</strong>
        </div>
        <pre><code># Update package list
sudo apt update

# Install Docker
sudo apt install docker.io docker-compose

# Start and enable Docker service
sudo systemctl start docker
sudo systemctl enable docker

# Add user to docker group (optional)
sudo usermod -aG docker $USER
# Logout and login again for group changes to take effect</code></pre>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Transfer Application</strong>
        </div>
        <pre><code># Option A: Clone from Git
git clone &lt;your-repository-url&gt;
cd impes

# Option B: Copy files via SCP
scp -r /path/to/impes user@new-machine:/destination/path/

# Option C: Copy files via rsync
rsync -avz /path/to/impes/ user@new-machine:/destination/path/impes/</code></pre>

        <div class="step">
            <span class="step-number">3</span>
            <strong>Deploy Application</strong>
        </div>
        <pre><code># Navigate to application directory
cd /path/to/impes

# Build containers (first time only)
docker-compose build

# Start all services
docker-compose up -d

# Verify deployment
docker-compose ps</code></pre>

        <div class="step">
            <span class="step-number">4</span>
            <strong>Verify Deployment</strong>
        </div>
        <pre><code># Test frontend
curl http://localhost/impes/

# Test API
curl http://localhost/api/auth/login

# Check logs
docker-compose logs</code></pre>

        <h2 id="github-registry">5. Pushing Images to GitHub Container Registry</h2>

        <div class="step">
            <span class="step-number">1</span>
            <strong>Prepare GitHub Container Registry</strong>
        </div>
        <ol>
            <li><strong>Create Personal Access Token</strong>
                <ul>
                    <li>Go to GitHub → Settings → Developer settings → Personal access tokens</li>
                    <li>Generate new token with <code>write:packages</code> scope</li>
                    <li>Copy the token</li>
                </ul>
            </li>
            <li><strong>Login to GitHub Container Registry</strong>
                <pre><code># Login to GitHub Container Registry
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin

# Or manually
docker login ghcr.io
# Username: your-github-username
# Password: your-personal-access-token</code></pre>
            </li>
        </ol>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Tag Images for GitHub Registry</strong>
        </div>
        <pre><code># Tag your images with GitHub Container Registry format
docker tag impes-frontend ghcr.io/USERNAME/impes-frontend:latest
docker tag impes-api ghcr.io/USERNAME/impes-api:latest
docker tag nginx:alpine ghcr.io/USERNAME/impes-nginx:latest

# For versioned releases
docker tag impes-frontend ghcr.io/USERNAME/impes-frontend:v1.0.0
docker tag impes-api ghcr.io/USERNAME/impes-api:v1.0.0</code></pre>

        <div class="step">
            <span class="step-number">3</span>
            <strong>Push Images to Registry</strong>
        </div>
        <pre><code># Push all tagged images
docker push ghcr.io/USERNAME/impes-frontend:latest
docker push ghcr.io/USERNAME/impes-api:latest
docker push ghcr.io/USERNAME/impes-nginx:latest

# Push versioned releases
docker push ghcr.io/USERNAME/impes-frontend:v1.0.0
docker push ghcr.io/USERNAME/impes-api:v1.0.0</code></pre>

        <div class="step">
            <span class="step-number">4</span>
            <strong>Automated Deployment Script</strong>
        </div>
        <p>Use the provided <code>deploy.sh</code> script for automated deployment:</p>
        <pre><code># Make script executable
chmod +x deploy.sh

# Update your GitHub username in the script
nano deploy.sh

# Set your GitHub token
export GITHUB_TOKEN=your_token_here

# Run deployment
./deploy.sh</code></pre>

        <h3>Production docker-compose.yml</h3>
        <p>The script will generate a <code>docker-compose.production.yml</code> file that uses the GitHub Container Registry images.</p>

        <h2 id="troubleshooting">6. Troubleshooting</h2>

        <h3>Common Issues</h3>

        <h4>1. Port Already in Use</h4>
        <pre><code># Check what's using the port
sudo netstat -tulpn | grep :80

# Kill process if needed
sudo pkill -f &lt;process-name&gt;</code></pre>

        <h4>2. Permission Denied</h4>
        <pre><code># Restart Docker service
sudo systemctl restart docker

# Check Docker group membership
groups $USER</code></pre>

        <h4>3. Container Won't Start</h4>
        <pre><code># Check logs
docker-compose logs &lt;service-name&gt;

# Check container status
docker-compose ps -a</code></pre>

        <h4>4. Database Connection Issues</h4>
        <pre><code># Check MySQL container
docker-compose logs mysql_db

# Restart database
docker-compose restart mysql_db</code></pre>

        <h3>Debug Commands</h3>
        <pre><code># View all containers
docker ps -a

# View container logs
docker logs &lt;container-name&gt;

# Execute commands in container
docker exec -it &lt;container-name&gt; /bin/bash

# Check network
docker network ls
docker network inspect impes_default</code></pre>

        <h2 id="maintenance">7. Maintenance</h2>

        <h3>Regular Tasks</h3>

        <h4>1. Update Images</h4>
        <pre><code># Pull latest images
docker-compose pull

# Restart services
docker-compose up -d</code></pre>

        <h4>2. Backup Database</h4>
        <pre><code># Create backup
docker-compose exec mysql_db mysqldump -u root -p imbesdb > backup_$(date +%Y%m%d_%H%M%S).sql

# Restore backup
docker-compose exec -T mysql_db mysql -u root -p imbesdb &lt; backup_file.sql</code></pre>

        <h4>3. Clean Up</h4>
        <pre><code># Remove unused images
docker image prune -a

# Remove unused volumes
docker volume prune

# Remove unused networks
docker network prune</code></pre>

        <h4>4. Monitor Resources</h4>
        <pre><code># Check resource usage
docker stats

# Check disk usage
docker system df</code></pre>

        <h3>Security Considerations</h3>
        <div class="warning">
            <ul>
                <li>Never commit <code>.env</code> files to version control</li>
                <li>Use strong passwords for database</li>
                <li>Rotate secrets regularly</li>
                <li>Configure firewall rules</li>
                <li>Use HTTPS in production</li>
                <li>Keep base images updated</li>
            </ul>
        </div>

        <h2>Production Deployment Workflow</h2>

        <div class="success">
            <h3>Quick Deploy Command</h3>
            <pre><code># One-liner deployment
git clone &lt;repo&gt; && cd impes && docker-compose up -d</code></pre>
        </div>

        <h3>Health Check Endpoints</h3>
        <pre><code># Frontend health check
curl http://localhost/impes/

# API health check
curl http://localhost/api/

# Database connection test
docker-compose exec api node -e "console.log('API running')"</code></pre>

        <h2>Support and Resources</h2>
        <ul>
            <li><a href="https://docs.docker.com/">Docker Documentation</a></li>
            <li><a href="https://docs.docker.com/compose/">Docker Compose Documentation</a></li>
            <li><a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry">GitHub Container Registry</a></li>
        </ul>

        <div class="footer">
            <p><strong>IMPES Application Deployment Guide</strong></p>
            <p>This deployment guide provides a comprehensive workflow for deploying the IMPES application on any machine.</p>
            <p>Key benefits: <strong>Portability</strong> • <strong>Consistency</strong> • <strong>Scalability</strong> • <strong>Maintainability</strong></p>
            <p><em>Last updated: September 2025 | Version: 1.0</em></p>
        </div>
    </div>
</body>
</html>
